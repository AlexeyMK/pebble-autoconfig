Pebble.addEventListener("ready", function(e) {
    var settings;
	try {

		settings = JSON.parse(localStorage['{{shortName}}']);
	}
	catch(e) {
		settings = {
			{% for item in preferences['items']: -%}
			"{{ item['name'] }}" : "{{ item['default'] }}",
			{% endfor %}
		};
		localStorage['{{shortName}}'] = JSON.stringify(settings);
	}
	Pebble.sendAppMessage(settings);
});

Pebble.addEventListener("showConfiguration", function (e) {
    Pebble.openURL("{{ preferences['url'] }}");
});

Pebble.addEventListener("webviewclosed", function(e) {
	localStorage['{{shortName}}'] = decodeURIComponent(e.response);
    var settings = JSON.parse(localStorage['{{shortName}}']);
    Pebble.sendAppMessage(settings);
});